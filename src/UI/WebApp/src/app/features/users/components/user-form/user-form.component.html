<div class="user-form-container">
  <div class="form-header">
    <h2>{{ isEditMode() ? 'Edit User' : 'Create User' }}</h2>
    <button class="btn btn-secondary" (click)="goBack()">‚Üê Back</button>
  </div>

  @if (loading()) {
    <div class="loading">Loading...</div>
  }

  @if (error()) {
    <div class="error">{{ error() }}</div>
  }

  @if (!loading()) {
    <form [formGroup]="userForm" (ngSubmit)="onSubmit()" class="user-form">
      <div class="form-group">
        <label for="firstName">First Name *</label>
        <input
          id="firstName"
          type="text"
          formControlName="firstName"
          class="form-control"
          [class.invalid]="isFieldInvalid('firstName')"
        />
        @if (isFieldInvalid('firstName')) {
          <div class="error-message">
            @if (userForm.get('firstName')?.hasError('required')) {
              First name is required
            }
            @if (userForm.get('firstName')?.hasError('maxlength')) {
              First name cannot exceed 100 characters
            }
          </div>
        }
      </div>

      <div class="form-group">
        <label for="lastName">Last Name *</label>
        <input
          id="lastName"
          type="text"
          formControlName="lastName"
          class="form-control"
          [class.invalid]="isFieldInvalid('lastName')"
        />
        @if (isFieldInvalid('lastName')) {
          <div class="error-message">
            @if (userForm.get('lastName')?.hasError('required')) {
              Last name is required
            }
            @if (userForm.get('lastName')?.hasError('maxlength')) {
              Last name cannot exceed 100 characters
            }
          </div>
        }
      </div>

      @if (!isEditMode()) {
        <div class="form-group">
          <label for="email">Email *</label>
          <input
            id="email"
            type="email"
            formControlName="email"
            class="form-control"
            [class.invalid]="isFieldInvalid('email')"
          />
          @if (isFieldInvalid('email')) {
            <div class="error-message">
              @if (userForm.get('email')?.hasError('required')) {
                Email is required
              }
              @if (userForm.get('email')?.hasError('email')) {
                Invalid email format
              }
            </div>
          }
        </div>

        <div class="form-group">
          <label for="password">Password *</label>
          <input
            id="password"
            type="password"
            formControlName="password"
            class="form-control"
            [class.invalid]="isFieldInvalid('password')"
          />
          @if (isFieldInvalid('password')) {
            <div class="error-message">
              @if (userForm.get('password')?.hasError('required')) {
                Password is required
              }
              @if (userForm.get('password')?.hasError('minlength')) {
                Password must be at least 8 characters
              }
              @if (userForm.get('password')?.hasError('pattern')) {
                Password must contain uppercase, lowercase, and numbers
              }
            </div>
          }
        </div>
      }

      <div class="form-group checkbox-group">
        <label>
          <input
            type="checkbox"
            formControlName="isActive"
          />
          <span>Active User</span>
        </label>
      </div>

      <div class="form-actions">
        <button type="button" class="btn btn-secondary" (click)="goBack()">
          Cancel
        </button>
        <button type="submit" class="btn btn-primary" [disabled]="userForm.invalid || submitting()">
          {{ submitting() ? 'Saving...' : (isEditMode() ? 'Update' : 'Create') }}
        </button>
      </div>
    </form>
  }
</div>
