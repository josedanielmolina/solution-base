<div class="change-password-container">
    <div class="change-password-card">
        <h1>Cambiar Contraseña</h1>
        @if (isForced()) {
        <p class="subtitle warning">Tu contraseña ha expirado. Debes cambiarla para continuar.</p>
        } @else {
        <p class="subtitle">Ingresa tu contraseña actual y la nueva contraseña</p>
        }

        <form [formGroup]="passwordForm" (ngSubmit)="onSubmit()">
            <div class="form-group">
                <label for="currentPassword">Contraseña Actual</label>
                <input type="password" id="currentPassword" formControlName="currentPassword" placeholder="••••••••"
                    [class.error]="passwordForm.get('currentPassword')?.invalid && passwordForm.get('currentPassword')?.touched">
                @if (passwordForm.get('currentPassword')?.invalid && passwordForm.get('currentPassword')?.touched) {
                <span class="error-message">La contraseña actual es requerida</span>
                }
            </div>

            <div class="form-group">
                <label for="newPassword">Nueva Contraseña</label>
                <input type="password" id="newPassword" formControlName="newPassword" placeholder="••••••••"
                    [class.error]="passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched">
                @if (passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched) {
                <span class="error-message">
                    @if (passwordForm.get('newPassword')?.errors?.['required']) {
                    La nueva contraseña es requerida
                    }
                    @if (passwordForm.get('newPassword')?.errors?.['minlength']) {
                    La contraseña debe tener al menos 8 caracteres
                    }
                </span>
                }
            </div>

            <div class="form-group">
                <label for="confirmPassword">Confirmar Nueva Contraseña</label>
                <input type="password" id="confirmPassword" formControlName="confirmPassword" placeholder="••••••••"
                    [class.error]="passwordForm.get('confirmPassword')?.invalid && passwordForm.get('confirmPassword')?.touched">
                @if (passwordForm.get('confirmPassword')?.invalid && passwordForm.get('confirmPassword')?.touched) {
                <span class="error-message">La confirmación es requerida</span>
                }
            </div>

            @if (errorMessage()) {
            <div class="alert alert-error">
                {{ errorMessage() }}
            </div>
            }

            @if (successMessage()) {
            <div class="alert alert-success">
                {{ successMessage() }}
            </div>
            }

            <button type="submit" class="btn btn-primary btn-block" [disabled]="passwordForm.invalid || loading()">
                @if (loading()) {
                <span>Guardando...</span>
                } @else {
                <span>Cambiar Contraseña</span>
                }
            </button>
        </form>
    </div>
</div>